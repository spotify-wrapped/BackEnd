<button onClick="createPlaylist()">Create Playlist</button>

<div>
    <h1>Top Songs</h1>
    <div id='topSongs'></div>
</div>

<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous">
</script>

<!-- Main -->
<script>
    const accessToken = sessionStorage.getItem('accessToken');

    getTopTracks();
    async function getTopTracks() {
        try {

            const { items: topTracks } = await $.post(window.location.origin + '/top', { accessToken });
            
            displayTracks(topTracks); 
            displayAnalysis(topTracks); // This function is included in a seperate file. It is not visible here because it is loaded through handlebars server side

        }catch(err) {
            console.log(err);
            $("#main").append('<div>Please refresh page</div>');
        }
    }
</script>

<script>
    function displayTracks(topTracks){
        $(document).ready(function(){
            topTracks.forEach(track => {
                const { album, artists, id, name } = track;
                const { name: albumName } = album;
                const albumArt = album.images[1];

                $("#topSongs").append('<div id='+id+'></div>');
                $(`#${id}`).append('<p>Name: '+name+' | Album: '+albumName+'</p>');
                artists.forEach(artist => {
                    $(`#${id}`).append('<p>Artist: ' +artist.name+ '</p>')
                });
                $(`#${id}`).append(`<img src=${albumArt.url} height=75/>`);
            });
        });
    }
</script>

<script>
    function createPlaylist(){
        $.post(
            window.location.origin + '/createPlaylist',
            {
                accessToken
            },
            (data, status) => {
                console.log(`Playlist Created! Data: ${data}, Status: ${status}`);
            }
        );
    }
</script>